!function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="/",o(o.s=5)}([function(e,n){e.exports=require("express")},function(e,n){e.exports=require("mongoose")},function(e,n,o){var t=o(1);e.exports=t.model("users",{username:String,password:String})},function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("path")},function(e,n,o){"use strict";o.r(n);var t=o(4),r=o.n(t),s=o(0),u=o.n(s),i=o(6),a=o(1),c=o(2),l=o(7),d=o(3),f=o(8);o(9)(f);o(10);var p=u()(),g=__dirname,m=r.a.join(g,"index.html");p.use(u.a.urlencoded({extended:!0})),p.use(u.a.json()),p.use(f({secret:"testProject",resave:!1,saveUninitialized:!1,cookie:{path:"/",httpOnly:!0,maxAge:36e5}})),p.use(d.initialize()),p.use(d.session()),p.use(u.a.static(g));var v=function(e,n,o){e.isAuthenticated()?o():n.json({status_text:"NO"})};p.post("/login",function(e,n,o){d.authenticate("local",function(t,r){return t?o(t):r?void e.logIn(r,function(e){return e?o(e):n.json({text:"Everything is good!",redirect:"/personalPage",status_text:"OK"})}):n.json({err:"Bad username or password!",redirect:"/",status_text:"NO"})})(e,n,o)}),p.post("/reg",function(e,n,o){var t={username:e.body.username,password:e.body.password};c.findOne({username:t.username},function(e,r){if(e)return console.log("Error in SignUp: "+e),o(e);if(r)n.json({text:"This name is busy!",err:"Busy name!",redirect:"/",status_text:"NO"});else{var s=new c;s.username=t.username,s.password=t.password,s.save(function(e){e&&(console.log("Error in Saving user: "+e),o(e)),n.json({text:"Your account created!",redirect:"/personalPage",status_text:"OK"})})}})}),p.get("/belove/add/:id",v,function(e,n,o){l.findOne({username:e.user.username,pokemonID:e.params.id},function(t,r){if(t)return console.log("Error in SignUp: "+t),o(t);if(r)console.log("This record is exist! User: ",e.user.username,"   pokemonID: ",e.params.id),l.deleteOne({username:e.user.username,pokemonID:e.params.id},function(e,t){if(e)return console.log("Error in SignUp: "+e),o(e);console.log("Recor deleted!"),n.json({text:"Recor deleted!!",status_text:"OK"})});else{var s=new l;s.username=e.user.username,s.pokemonID=e.params.id,s.save(function(t){t&&(console.log("Error in Saving user: "+t),o(t)),console.log("New beloved pokemon have added! User: ",e.user.username,"   pokemonID: ",e.params.id),n.json({text:"'New beloved pokemon have added!!",status_text:"OK"})})}})}),p.get("/belove/getList",v,function(e,n,o){l.find({username:e.user.username},function(t,r){if(t)return console.log("Error in SignUp: "+t),o(t);if(r){console.log("User: ",e.user.username," have next list: ",r);for(var s=[],u=0;u<r.length;u++)s.push(r[u].pokemonID);n.json({PokemonsList:s})}else console.log(" User: ",e.user.username,"  don't have beloved pokemons!"),n.json({PokemonsList:[]})})}),p.get("/currentUser",v,function(e,n,o){n.json({username:e.user.username,status_text:"OK"})}),p.get("/logout",v,function(e,n){e.logout()}),p.get("/auth/facebook",d.authenticate("facebook")),p.get("/auth/facebook/callback",function(e,n,o){d.authenticate("facebook",function(t,r){if(t)return o(t);e.logIn(r,function(e){return e?o(e):n.redirect("/personalPage")})})(e,n,o)}),p.get("*",function(e,n){n.sendFile(m)}),p.use(function(e,n,o,t){console.log(e),o.status(500).send("Something broke")});var b=process.env.PORT||8080;a.connect(i.url,{useNewUrlParser:!0}).then(function(e){p.listen(b,function(){console.log("App listening to ".concat(b,"....")),console.log("Press Ctrl+C to quit.")})}).catch(function(e){console.log("There was an ERROR: ",e)})},function(e,n){e.exports={url:"mongodb+srv://admin:admin@pokedex-4iocn.mongodb.net/test?retryWrites=true&w=majority"}},function(e,n,o){var t=o(1);e.exports=t.model("belovePokemon",{username:String,pokemonID:String})},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("connect-redis")},function(e,n,o){var t=o(3),r=o(11).Strategy,s=o(12).Strategy,u=o(2);t.serializeUser(function(e,n){n(null,e.id)}),t.deserializeUser(function(e,n){u.findById(e,function(e,o){n(e,o)})}),t.use(new r(function(e,n,o){u.findOne({username:e},function(e,t){return e?o(e):t?n!==t.password?(console.log("Wrong password!"),o(null,!1)):o(null,t):(console.log("User don't exist!"),o(null,!1))})})),t.use(new s({clientID:"465627924258520",clientSecret:"6fe608d458734e9752b6307ec8d1fc2d",callbackURL:"https://sstelss.github.io/auth/facebook/callback"},function(e,n,o,t){u.findOne({username:o.id},function(e,n){return e?t(e):n?t(e,n):void(n=new u({username:o.id,provider:"facebook",facebook:o._json})).save(function(e){return e&&console.log(e),t(e,n)})})}))},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("passport-facebook")}]);